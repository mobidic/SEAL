{% extends 'base.html' %}

{% block static %}
    <link href="{{ url_for('static', filename='select2/css/select2.min.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='sweetalert/sweetalert2.min.css') }}" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='jquery-ui/jquery-ui.css') }}">
    {% include 'includes/loading_bar.dt.j2' %}

    <link href="{{ url_for('static', filename='seal/analysis/sample.css') }}" rel="stylesheet" type="text/css">
{% endblock %}

{% block content %}
    {% include 'includes/sidebar-sample.j2' %}
    <div class="w3-main {% if sample.status == 5 %}w3-disabled{% endif %}">
        <div class="w3-container">
            <div class="w3-center">
                <h1>{{ sample.samplename}}</h1>
                {% include 'includes/button-status-sample.j2' %}
            </div>
            <hr>
        </div>
        <div class="w3-padding w3-small">
            <div class="seal-form-report w3-row w3-padding {% if sample.status == 4 %}w3-disabled {% endif %}">
                <div class="w3-col l4 m6 s12 w3-row w3-padding">
                    <div class="w3-col w3-text-flat-green-sea l6 m6 s6"><p><i class="fa fa-filter fa-xl"></i> <b>Choose a filter</b></p></div>
                    <select id="selectFilter" class="w3-select w3-col l6 m6 s6 w3-border" onchange="changeFilter(value, '{{ sample.id }}');">
                    </select>
                </div>
                <div class="w3-col l4 m6 s12 w3-row w3-padding">
                    <div class="w3-col w3-text-flat-green-sea l6 m6 s6"><p><i class="fas fa-th-list fa-xl"></i> <b>Choose a panel</b></p></div>
                    <select id="selectBed" class="w3-select w3-col l6 m6 s6 w3-border" onchange="applied_panel(value, '{{ sample.id }}');">
                    </select>
                </div>
                <div class="w3-col l4 m6 s12 w3-row w3-padding">
                    <p class="w3-text-flat-green-sea"><i class="fa fa-circle-info fa-xl"></i> <b>Clinvar Version : <i>{{ clinvar.version }}</i></b></p>
                </div>
            </div>
            <div class="w3-padding">
                <table id="variants" class="w3-table display" style="width:100%">
                    <thead>
                        <tr>
                            <th rowspan="2" class='min-size-75'><span class="seal-display-middle">Gene</span></th>
                            <th rowspan="2" class='min-size-75'><span class="seal-display-middle"></span></th>
                            <th colspan="4" class="w3-border-right">Nomenclature</th>
                            <th colspan="{{ sample.caller|length }}" class="w3-border-right">Variant</th>
                            {% if family_members|length > 0 %}
                                <th colspan="{{ family_members|length }}" class="w3-border-right">Family<br /><span class="w3-text-flat-pumpkin w3-tiny"><i class="fa-solid fa-triangle-exclamation"></i> Only max values</span></th>
                            {% endif %}
                            <th colspan="2" class="w3-border-right">Population Frequency</th>
                            <th colspan="2" class="w3-border-right">Clinical Informations</th>
                            <th colspan="2" class="w3-border-right">Localisation</th>
                            <th colspan="3" class="w3-border-right">Predictions</th>
                            <th  rowspan="2" class='min-size-2x5'><span class="seal-display-middle">R</span></th>
                            <th  rowspan="2" class='min-size-75'><span class="seal-display-middle">Class</span></th>
                            <th  rowspan="2" class='size-50'></th>
                        </tr>
                        <tr>
                            <th class='min-size-75'>HGVSg</th>
                            <th class='min-size-75'>HGVSc</th>
                            <th class='min-size-75'>HGVSp</th>
                            <th class='min-size-50'>E|I</th>
                            <!-- <th class='min-size-75'>Filter</th> -->
                            {% for c in sample.caller %}
                                <th class='min-size-75'>{{ c }}</th>
                            {% endfor %}
                            {% for s in family_members %}
                                <th class='min-size-100'>{{ s }}</th>
                            {% endfor %}
                            <th class='min-size-75'>GnomAD</th>
                            <th class='min-size-75'>SEAL</th>
                            <th class='min-size-100'>ClinVar</th>
                            <th class='min-size-75'>Transmission</th>
                            <th class='min-size-75'>Impact</th>
                            <th class='min-size-75'>Consequence</th>
                            <th class='min-size-50'>MaxEnt</th>
                            <th class='min-size-50'>SpliceAI</th>
                            <th class='min-size-100'>Missense</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th>
                                <span title="Help" onclick="openHelp(title='Gene', content='The gene symbol (e.g. HGNC) (where available) to the output.', footer='For more information see : <a  href=\'https://www.genenames.org/\' target=\'_blank\' style=\'text-decoration:underline\'><i>HGNC</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                Gene
                            </th>
                            <th></th>
                            <th>
                                <span title="Help" onclick="openHelp(title='HGVSg', content='The HGVS genomic sequence name', footer='For more information see : <a  href=\'https://varnomen.hgvs.org/\' target=\'_blank\' style=\'text-decoration:underline\'><i>varnomen</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                HGVSg
                            </th>
                            <th>
                                <span title="Help" onclick="openHelp(title='HGVSc', content='The HGVS coding sequence name.<br /><br />Canonical transcript is defined by Ensembl algorithm following :<br /><ol><li>Longest CCDS translation with no stop codons.</li><li>If no (1), choose the longest Ensembl/Havana merged translation with no stop codons.</li><li>If no (2), choose the longest translation with no stop codons.</li><li>If no translation, choose the longest non-protein-coding transcript.</li></ol><br /><ul><li>the transcript is the canonical transcript for the gene<ul><li><i class=\'fas fa-star\'></i> (<i>canonical</i>)</li><li><i class=\'far fa-star\'></i> (<i>non canonical</i>)</li></ul></li><li>the transcript is one of your selected transcripts<ul><li><i class=\'w3-text-flat-peter-river fas fa-tint\'></i> (<i>selected</i>)</li><li><i class=\'fas fa-tint\'></i> (<i>not selected</i>)</li></ul></li></ul>', footer='For more information see : <a  href=\'https://varnomen.hgvs.org/\' target=\'_blank\' style=\'text-decoration:underline\'><i>varnomen</i></a>, <a  href=\'http://www.ensembl.org/info/genome/genebuild/canonical.html\' target=\'_blank\' style=\'text-decoration:underline\'><i>VEP documentation</i></a> & <a  href=\'{{ url_for('transcripts') }}\' target=\'_blank\' style=\'text-decoration:underline\'><i>Transcripts in SEAL</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                HGVSc
                            </th>
                            <th>
                                <span title="Help" onclick="openHelp(title='HGVSp', content='The HGVS protein sequence name', footer='For more information see : <a  href=\'https://varnomen.hgvs.org/\' target=\'_blank\' style=\'text-decoration:underline\'><i>varnomen</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                HGVSp
                            </th>
                            <th>
                                <span title="Help" onclick="openHelp(title='Exon/Intron', content='The number of the exon or intron wich have the variant.<br/><b>Exons are in bold</b>, <i>introns in italics.</i>', footer='')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                E|I
                            </th>
                            <!-- <th>
                                <span title="Help" onclick="openHelp(title='Filter', content='Filters applied to the variant.', footer='')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                Filter
                            </th> -->
                            {% for c in sample.caller %}
                                <th>
                                    <span title="Help" onclick="openHelp(title='Allelic frequencie', content='Frequence of the observed allele for the sample, and  Allelic Depth/Depth<br />Genotypes :<ul><li><i class=\'far fa-dot-circle\'></i> Mosaicism (< 0.25)</li><li><i class=\'fas fa-adjust\'></i> Heterozygous ref/alt (< 0.75)</li><li><i class=\'fas fa-circle\'></i> Homozygous alt/alt (>= 0.75)</li><li><i class=\'far fa-question-circle\'></i> Unknown status</li></ul>', footer='')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                        <i class="fas fa-question-circle w3-tiny"></i>
                                    </span>
                                    {{ c }}
                                </th>
                            {% endfor %}
                            {% for s in family_members %}
                                <th>
                                    <span title="Help" onclick="openHelp(title='{{ s }}', content='Frequence of the observed allele for the sample, and  Allelic Depth/Depth<br />Genotypes :<ul><li><i class=\'far fa-dot-circle\'></i> Mosaicism (< 0.25)</li><li><i class=\'fas fa-adjust\'></i> Heterozygous ref/alt (< 0.75)</li><li><i class=\'fas fa-circle\'></i> Homozygous alt/alt (>= 0.75)</li><li><i class=\'far fa-question-circle\'></i> Unknown status</li></ul>', footer='')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                        <i class="fas fa-question-circle w3-tiny"></i>
                                    </span>
                                    {{ s }}
                                </th>
                            {% endfor %}
                            <th>
                                <span title="Help" onclick="openHelp(title='GnomAD', content='The Genome Aggregation Database (gnomAD) is a resource developed by an international coalition of investigators, with the goal of aggregating and harmonizing both exome and genome sequencing data from a wide variety of large-scale sequencing projects, and making summary data available for the wider scientific community.<br /> The dataset used is from release 2.1 genomes (GRCh37/hg19) spans 15,708 whole-genome sequences from unrelated individuals sequenced as part of various disease-specific and population genetic studies.', footer='For more information see : <a  href=\'https://gnomad.broadinstitute.org\' target=\'_blank\' style=\'text-decoration:underline\'><i>GnomAD website</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                <i class="fas fa-question-circle w3-tiny"></i>
                            </span>
                                GnomAD
                            </th>
                            <th>
                                <span title="Help" onclick="openHelp(title='SEAL', content='The number of occurences for this variant among all database.', footer='')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                SEAL
                            </th>
                            <th>
                                <span title="Help" onclick="openHelp(title='ClinVar', content='ClinVar clinical significance of the variant.<br /><ul><li><i class=\'fa-solid fa-star fa-2xs\'></i><i class=\'fa-solid fa-star fa-2xs\'></i><i class=\'fa-solid fa-star fa-2xs\'></i><i class=\'fa-solid fa-star fa-2xs\'></i> : practice guideline</li><li><i class=\'fa-solid fa-star fa-2xs\'></i><i class=\'fa-solid fa-star fa-2xs\'></i><i class=\'fa-solid fa-star fa-2xs\'></i><i class=\'fa-regular fa-star fa-2xs\'></i> : reviewed by expert panel</li><li><i class=\'fa-solid fa-star fa-2xs\'></i><i class=\'fa-solid fa-star fa-2xs\'></i><i class=\'fa-regular fa-star fa-2xs\'></i><i class=\'fa-regular fa-star fa-2xs\'></i> : criteria provided, multiple submitters, no conflicts</li><li><i class=\'fa-solid fa-star fa-2xs\'></i><i class=\'fa-regular fa-star fa-2xs\'></i><i class=\'fa-regular fa-star fa-2xs\'></i><i class=\'fa-regular fa-star fa-2xs\'></i> : criteria provided, conflicting interpretations or single submitter</li><li><i class=\'fa-regular fa-star fa-2xs\'></i><i class=\'fa-regular fa-star fa-2xs\'></i><i class=\'fa-regular fa-star fa-2xs\'></i><i class=\'fa-regular fa-star fa-2xs\'></i> : no assertion </li></ul><br /><ul><li><span class=\'w3-tag w3-flat-turquoise\'>Benign\Likely Benign</span></li><li><span class=\'w3-tag w3-flat-peter-river\'>Conflicting (VUS/Benign)</span></li><li><span class=\'w3-tag w3-flat-sun-flower\'>Uncertain</span></li><li><span class=\'w3-tag w3-flat-carrot\'>Conflicting (with Pathogenic)</span></li><li><span class=\'w3-tag w3-flat-alizarin\'>Pathogenic/Likely pathogenic</span></li><li><span class=\'w3-tag w3-flat-silver\'>Other</span></li></ul>', footer='For more information see : <a  href=\'https://www.ncbi.nlm.nih.gov/clinvar/docs/clinsig/\' target=\'_blank\' style=\'text-decoration:underline\'><i>ClinSig documentation</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                ClinVar
                            </th>
                            <th>
                                <span title="Help" onclick="openHelp(title='Transmission', content='This column represent the transmission mode following OMIM data.<br /><ul><li><b>AD</b>: Autosomal dominant</li><li><b>AR</b>: Autosomal recessive</li><li><b>DD</b>: Digenic dominant</li><li><b>DR</b>: Digenic recessive</li><li><b>IC</b>: Isolated cases</li><li><b>Mito</b>: Mitochondrial</li><li><b>MF</b>: Multifactorial</li><li><b>PAD</b>: Pseudoautosomal dominant</li><li><b>PAR</b>: Pseudoautosomal recessive</li><li><b>SMos</b>: Somatic mosaicism</li><li><b>SMut</b>: Somatic mutation</li><li><b>XL</b>: X-linked</li><li><b>XLD</b>: X-linked dominant</li><li><b>XLR</b>: X-linked recessive</li><li><b>YL</b>: Y-linked</li></ul><br /><i class=\'fas fa-question-circle w3-tiny\'></i> A question mark (?) indicates that the relationship between the phenotype and gene is provisional', footer='For more information see : <a  href=\'https://www.omim.org/\' target=\'_blank\' style=\'text-decoration:underline\'><i>OMIM</i></a>' )" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                Transmission
                            </th>
                            <th>
                                <span title="Help" onclick="openHelp(title='Impact', content='IMPACT is calculated by VEP, based on consequences and compatibility with snpEff. <div class=\'w3-flash w3-warning\'><p>Impact categories must be used with care, they were created only to help and simplify the filtering process. Obviously, there is no way to predict whether a HIGH impact or a LOW impact variant is the one producing a phenotype of interest.</p></div>', footer='For more information see : <a  href=\'https://m.ensembl.org/info/genome/variation/prediction/predicted_data.html\' target=\'_blank\' style=\'text-decoration:underline\'><i>VEP documentation</i></a> & <a  href=\'https://pcingola.github.io/SnpEff/se_inputoutput/#impact-prediction\' target=\'_blank\' style=\'text-decoration:underline\'><i>snpEff documentation</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                Impact
                            </th>
                            <th>
                                <span title="Help" onclick="openHelp(title='Consequence', content='Consequences are calculated by VEP following SO terms.', footer='For more information see : <a  href=\'https://m.ensembl.org/info/genome/variation/prediction/predicted_data.html\' target=\'_blank\' style=\'text-decoration:underline\'><i>VEP documentation</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                Consequence
                            </th>
                            <th>
                                <span title="Help" onclick="openHelp(title='MaxEntScan', content='Algorithms for derivation and scoring of constrained-marginal maximum entropy distributions, with applications to 5\' and 3\' splice sites. <br />We suggest this cutoff: <br /><ul><li class=\'w3-text-flat-pomegranate\'>|percent variation| &ge; 15\%</li></ul>', footer='For more information see : <a  href=\'https://github.com/guillermomarco/VEP_plugins/blob/master/MaxEntScan.pm\' target=\'_blank\' style=\'text-decoration:underline\'><i>VEP MES plugin</i></a> & <a  href=\'https://github.com/esebesty/maxentscan\' target=\'_blank\' style=\'text-decoration:underline\'><i>MaxEntScan</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                MaxEnt
                            </th>
                            <th>
                                <span title="Help" onclick="openHelp(title='SpliceAI DeltaScore', content='Delta score (DS) of a variant, defined as the maximum of ranges from 0 to 1 and can be interpreted as the probability of the variant being splice-altering. The author-suggested cutoffs are: <br /><ul><li class=\'w3-text-flat-sun-flower\'>0.2 (high recall)</li><li class=\'w3-text-flat-orange\'>0.5 (recommended)</li><li class=\'w3-text-flat-pomegranate\'>0.8 (high precision)</li></ul>', footer='For more information see : <a  href=\'https://github.com/Ensembl/VEP_plugins/blob/release/104/SpliceAI.pm\' target=\'_blank\' style=\'text-decoration:underline\'><i>VEP plugins spliceAI</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                SpliceAI
                            </th>
                            <th>
                                <span title="Help" onclick="openHelp(title='Missense', content='This score represents the mean rank scores of the top 10 missense predictions tools from dbNSFP v4.<br /><ul><li>CADD</li><li>VEST4</li><li>MetaSVM</li><li>MetaLR</li><li>Eigen</li><li>Eigen-PC</li><li>REVEL</li><li>BayesDel_addAF</li><li>BayesDel_noAF</li><li>ClinPred</li></ul><br />The threshold are : <ul><li><span class=\'w3-tag w3-flat-pomegranate\'>0.95</span> <i>top 5% deleteriousness of all missense variant</i></li><li><span class=\'w3-text-flat-pomegranate\'>0.9</span> <i>top 10% deleteriousness of all missense variant</i></li><li><span class=\'w3-text-flat-orange\'>0.75</span> <i>top 25% deleteriousness of all missense variant</i></li><li><span class=\'w3-text-flat-sun-flower\'>0.5</span> <i>top 50% deleteriousness of all missense variant</i></li></ul>', footer='For more information see : <a  href=\'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7709417/\' target=\'_blank\' style=\'text-decoration:underline\'><i>dbNSFP v4</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                Missense
                            </th>
                            <th>
                                R
                            </th>
                            <th style="padding:10px 10px 6px 10px!important">
                                <span title="Help" onclick="openHelp(title='Class', content='You can choose the classification:<ul><li class=\'w3-text-flat-green-sea\'>Benign</li><li class=\'w3-text-flat-nephritis\'>Likely Benign</li><li class=\'w3-text-flat-belize-hole\'>VUS</li><li class=\'w3-text-flat-pumpkin\'>Likely Pathogenic</li><li class=\'w3-text-flat-pomegranate\'>Pathogenic</li></ul>', footer='For more information see : <a  href=\'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4544753/\' target=\'_blank\' style=\'text-decoration:underline\'><i>ACMG guidelines</i></a>')" class="w3-opacity-max w3-hover-opacity" style="cursor:pointer">
                                    <i class="fas fa-question-circle w3-tiny"></i>
                                </span>
                                Class
                            </th>
                            <th></th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="w3-container w3-center">
            <hr>
        </div>

        <div class="w3-container w3-padding">
            <div id="comments_sample" class=" w3-container w3-border-right">
                <h2><i class="w3-text-flat-green-sea w3-xxlarge fas fa-comment"></i> Comments (<span class="commentsCountSample">{{ sample.comments | length }}</span>)</h2>

                <div id="commentsTableSample" class="w3-small">
                    <table id="tableCommentsSample" class="display" style="width:100%">
                        <thead>
                            <tr>
                                <th class="no-sort" style="width:20%">User</th>
                                <th class="no-sort" style="width:60%">Comment</th>
                                <th style="width:20%">Date</th>
                            </tr>
                        </thead>
                    </table>
                </div>

                {{ form.hidden_tag() }}
                <div class="w3-row w3-section">
                    <div class="w3-rest">
                        {% if form.comment.errors %}
                            {{ form.comment(class="w3-input w3-border w3-border-red") }}
                            <div class="w3-small w3-text-flat-alizarin">
                                {% for error in form.comment.errors %}
                                    <i class="fas fa-exclamation-circle"></i> {{ error }}
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.comment(id="comment_sample", class="w3-input w3-border") }}
                        {% endif %}
                    </div>
                </div>

                <div class="w3-section w3-center">
                    {{ form.submit(id="submitCommentSample", class="w3-button w3-flat-green-sea w3-hover-flat-turquoise", onclick="send_comment();") }}
                </div>
            </div>
        </div>
        <div class="w3-container w3-center">
            <hr>
        </div>
    </div>

    <!-- MODALS -->
    <div id="filter-modal" class="w3-modal">
        <div class="w3-modal-content w3-card-4">
            <header class="w3-container w3-flat-green-sea">
                <span onclick="$('#filter-modal').toggle()"
                    class="w3-button w3-display-topright">&times;</span>
                <h5 id="filter-modal-title">Save Filter</h5>
            </header>
            <div class="w3-container">
                {{ saveFilterForm.hidden_tag() }}
                <div class="w3-row w3-section">
                    <div class="w3-col w3-display-container w3-text-flat-green-sea w3-margin-right" style="width:50px"><i class="w3-xxlarge fas fa-tag"></i></div>
                    <div class="w3-rest">
                        {% if saveFilterForm.filterName.errors %}
                            {{ saveFilterForm.filterName(class="w3-input w3-border w3-border-red") }}
                            <div class="w3-small w3-text-flat-alizarin">
                                {% for error in saveFilterForm.filterName.errors %}
                                    <i class="fas fa-exclamation-circle"></i> {{ error }}
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ saveFilterForm.filterName(class="w3-input w3-border") }}
                        {% endif %}
                    </div>
                </div>

                <div class="w3-row w3-section w3-display-container">
                    <div class="w3-middle w3-col w3-display-container w3-text-flat-green-sea w3-margin-right" style="width:50px"><i class="w3-xxlarge fas fa-users"></i></div>
                    <div class="w3-rest" id="create-filter">
                        {{ saveFilterForm.teams(class="js-example-basic-multiple", multiple="multiple", style="width:100%") }}
                    </div>
                </div>
                <div class="w3-row w3-section">
                    <div class="w3-col w3-display-container w3-text-flat-green-sea w3-margin-right" style="width:50px"><i class="w3-xxlarge fas fa-filter"></i></div>
                    <div class="w3-rest">
                        {% if saveFilterForm.filterText.errors %}
                            {{ saveFilterForm.filterText(class="w3-input w3-border w3-border-red") }}
                            <div class="w3-small w3-text-flat-alizarin">
                                {% for error in saveFilterForm.filterText.errors %}
                                    <i class="fas fa-exclamation-circle"></i> {{ error }}
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ saveFilterForm.filterText(class="w3-input w3-border", disabled=True) }}
                        {% endif %}
                    </div>
                </div>

                <div class="w3-section w3-center">
                    {{ saveFilterForm.submit(id="validateSaveFilter", class="w3-button w3-flat-green-sea w3-hover-flat-turquoise", onclick="saveFilter();") }}
                </div>
            </div>
            <footer class="w3-container w3-light-grey w3-padding">
                <button class="w3-button w3-right w3-white w3-border"
                onclick="$('#filter-modal').toggle()">Close</button>
            </footer>
        </div>
    </div>

    <div id="modal-details-variant" class="w3-modal">
        <div class="w3-modal-content w3-card-4 w3-animate-zoom">
            <header class="w3-container w3-flat-green-sea">
                <span onclick="$('#modal-details-variant').toggle()"
                class="w3-button w3-xlarge w3-display-topright">&times;</span>
                <h2>Variant : <span id="variant-id"><span></h2>
            </header>

            <div class="w3-bar w3-border-bottom">
                <button class="tablink w3-bar-item w3-button" onclick="openDetails(event, 'allTranscripts')">Transcripts</button>
                <button class="tablink w3-bar-item w3-button" onclick="openDetails(event, 'missense')">Missense</button>
                <button class="tablink w3-bar-item w3-button" onclick="openDetails(event, 'conservation')">Conservation</button>
                <button class="tablink w3-bar-item w3-button" onclick="openDetails(event, 'population')">Population</button>
                <button class="tablink w3-bar-item w3-button" onclick="openDetails(event, 'splicing')">Splicing</button>
                <button class="tablink w3-bar-item w3-button" onclick="openDetails(event, 'links')">Links</button>
                <button class="tablink w3-bar-item w3-button" onclick="openDetails(event, 'inseal')">In Seal (<span class="inSealCount"></span>)</button>
                <button class="tablink w3-bar-item w3-button" onclick="openDetails(event, 'comments')">Comments (<span class="commentsCountVar"></span>)</button>
            </div>

            <div id="allTranscripts" class="w3-container detail">
                <h3>Transcripts</h3>
                <div id="allTranscriptsTable"></div>
            </div>

            <div id="missense" class="w3-container detail">
                <h3>Missense</h3>
                <div class="w3-row">
                    <div id='radarMissense' class="w3-col l6 m12 s12"><!-- Plotly chart will be drawn inside this DIV --></div>
                    <div class="w3-col l6 m12 s12">
                        <div id="tableScoresPredictions"></div>
                    </div>
                </div>
            </div>

            <div id="conservation" class="w3-container detail">
                <h3>Conservation</h3>
                <div class="w3-row">
                    <div id='radarConservation' class="w3-col l6 m12 s12"><!-- Plotly chart will be drawn inside this DIV --></div>
                    <div class="w3-col l6 m12 s12">
                        <div id="tableScoresConservation"></div>
                    </div>
                </div>
            </div>

            <div id="population" class="w3-container detail">
                <h3>Population</h3>
                <div class="w3-row">
                    <div id='barPopulation' class=""><!-- Plotly chart will be drawn inside this DIV --></div>
                </div>
            </div>

            <div id="splicing" class="w3-container detail">
                <h3>Splicing</h1>
                <div class="w3-row">
                    <div id='chartSplicing' class="w3-col l3 m6 s6"><!-- Plotly chart will be drawn inside this DIV --></div>
                </div>
            </div>

            <div id="links" class="w3-container detail">
                <h3>Links</h3>
                <div id="links_exterior" style="column-count: 3;"></div>
                <div class="w3-padding w3-display-bottommiddle w3-tiny">
                    <span><i class="w3-text-flat-asbestos fas fa-flag"></i> dbSNP</span>
                    <span><i class="w3-text-flat-amethyst fas fa-disease"></i> Cosmic</span>
                    <span><i class="w3-text-flat-belize-hole fas fa-user-md"></i> ClinVar</span>
                    <span><i class="w3-text-flat-pomegranate fas fa-microscope"></i> UniProt</span>
                    <span><i class="w3-text-flat-wet-asphalt fas fa-book"></i> PubMed</span>
                </div>
            </div>

            <div id="inseal" class="w3-container detail">
                <h3>In Seal (<span class="inSealCount"></span>)</h3>
                <div id="inSEALTable"></div>
            </div>

            <div id="comments" class="w3-container detail">
                <h3>Comments (<span class="commentsCountVar"></span>)</h3>

                {{ form.hidden_tag() }}
                <div class="w3-row w3-section">
                    <div class="w3-col w3-display-container w3-text-flat-green-sea w3-margin-right" style="width:50px"><i class="w3-xxlarge fas fa-comment"></i></div>
                    <div class="w3-rest">
                        {% if form.comment.errors %}
                            {{ form.comment(class="w3-input w3-border w3-border-red") }}
                            <div class="w3-small w3-text-flat-alizarin">
                                {% for error in form.comment.errors %}
                                    <i class="fas fa-exclamation-circle"></i> {{ error }}
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.comment(id="commentVar", class="w3-input w3-border") }}
                        {% endif %}
                    </div>
                </div>

                <div class="w3-section w3-center">
                    {{ form.submit(id="submitComment", class="w3-button w3-flat-green-sea w3-hover-flat-turquoise", onclick="send_comment(type='var');") }}
                </div>
                <div id="commentsTableVar"></div>
            </div>

            <div class="w3-container w3-light-grey w3-padding">
                <button class="w3-button w3-right w3-white w3-border"
                onclick="$('#modal-details-variant').toggle()">Close</button>
            </div>
        </div>
    </div>

{% endblock %}


{% block script %}
    <script type="text/javascript" src="{{ url_for('static', filename='jquery-ui/jquery-ui.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='plotly-2.3.1.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='sweetalert/sweetalert2.min.js') }}"></script>
    <script src="{{ url_for('static', filename='select2/js/select2.full.min.js') }}"></script>
    <script src="{{ url_for('static', filename='DOMPurify/purify.min.js') }}"></script>

    <script type="text/javascript">
        var sample_filter_id = "{{ sample.filter_id }}";
        var current_user_filter_id = "{{ current_user.filter_id }}";
        var sample_bed_id = "{{ sample.bed_id }}";
        var current_user_bed_id = "{{ current_user.bed_id }}";
        var sample_variants_length = "{{ sample.variants | length  }}";
        var count_hide = "{{ count_hide }}";
        var json_variants = '/json/variants/sample/{{ sample.id }}{% if sample.bed_id %}/bed/{{ sample.bed_id }}{% endif %}';
        var sample_id = "{{ sample.id }}";
        var current_user_api_key_md = "{{ current_user.api_key_md }}";
        var current_user_transcripts = "{{ current_user.transcripts | safe }}";
        var sample_status = "{{ sample.status }}";
        var disabled_class = "{% if sample.status == 4 %}w3-disabled {% endif %}";
        var clinvar_stars = {
            'no_assertion_criteria_provided' : 0,
            'no_assertion_provided' : 0,
            'no_interpretation_for_the_single_variant' : 0,
            'criteria_provided_single_submitter' : 1,
            'criteria_provided_conflicting_interpretations' : 1,
            'criteria_provided_multiple_submitters_no_conflicts' : 2,
            'reviewed_by_expert_panel' : 3,
            'practice_guideline' : 4
        };

        var dt_table = [
            {
                className: 'showitle ',
                data: "annotations.SYMBOL",
                mytitle: function ( data ) {
                        if (data == null) {
                            return "<i>NA</i>";
                        }
                        return data;
                },
                render: {
                    _: function ( data, type, row ) {
                        if (data == null) {
                            return "<i>NA</i>";
                        }
                        return data;
                    },
                    sort: function ( data, type, row ) {
                        if (data == null) {
                            return -1;
                        }
                        return data;
                    },
                }
            },
            {
                className: 'w3-border-right no-padding',
                data: null,
                orderable: false,
                render: {
                    _: function ( data, type, row ) {
                        mobidetails="";
                        if (current_user_api_key_md !== "None") {
                            mobidetails = '<span onclick="openMD(\'' + data["annotations"]["HGVSc"] + '\')" class="fa-fw w3-text-flat-peter-river w3-hover-text-flat-carrot" style="cursor: pointer;"><span class="fa-layers"><i class="fas fa-bookmark"></i> <span class="fa-layers-text fa-inverse" data-fa-transform="shrink-10 up-2" style="font-weight:900">MD</span></span> MobiDetails</span> <br />'
                        }
                        franklin = '<a target="_blank" href="https://franklin.genoox.com/clinical-db/variant/snp/' + data["id"] + '-hg38" class="fa-layers fa-fw w3-text-flat-midnight-blue w3-hover-text-flat-wet-asphalt" style="cursor: pointer;"><span class="fa-layers"><i class="fas fa-bookmark"></i> <span class="fa-layers-text fa-inverse" data-fa-transform="shrink-10 up-2" style="font-weight:900">F</span></span> Franklin</a> ';
                        return "<div class='w3-tiny'>" + mobidetails + franklin + "</div>";
                    }
                }
            },
            {
                className: 'showTitle ',
                data: "annotations.HGVSg",
                mytitle: function ( data ) {
                        if (data == null) {
                            return "<i>NA</i>";
                        }
                        return data;
                },
                render : {
                    _: function ( data, type, row, meta ) {
                        return data;
                    },
                    sort: function ( data, type, row, meta ) {
                        if(data != null) {
                            var regExp = /(chr|cen|pter|qter|sup)?([0-9XYMt]+):[gmno]\.([0-9]+)(_[0-9]+)?([ACGT]+>)?(dup|ins|del|inv|[ACGT]+)?/;
                            var matches = regExp.exec(data);
                            var zero = "000000000"
                            var chr;
                            if (Number.isInteger(parseInt(matches[2]))) {
                                chr = (zero + matches[2]).slice(-2);
                            } else {
                                regExp2 = /^[Mm](t)?$/;
                                if(regExp2.test(matches[2])) {
                                    chr = 25;
                                }
                                regExp2 = /^[Yy]$/;
                                if(regExp2.test(matches[2])) {
                                    chr = 24;
                                }
                                regExp2 = /^[Xx]$/;
                                if(regExp2.test(matches[2])) {
                                    chr = 23;
                                }else {
                                    chr = (matches[2])
                                }
                            }
                            return chr + "_" + (zero + matches[3]).slice(-9) + "_" + matches[6];
                        } else {
                            num = -1
                            return num.toFixed(6);
                        }
                    },
                },
            },
            {
                className: 'showTitle ',
                data: "annotations",
                mytitle: function ( data ) {
                        if (data == null) {
                            return "<i>NA</i>";
                        }
                        response = "";
                        if (data["canonical"]) {
                            response = ' (canonical)';
                        } 
                        if (data["preferred"]) {
                            response += " (selected)";
                        }
                        return data["HGVSc"] + response;
                },
                render: {
                    _: function ( data, type, row ) {
                        if (data["HGVSc"] == null) {
                            return "NA";
                        }
                        return data["HGVSc"];
                    },
                    display: function ( data, type, row ) {
                        if (data == null) {
                            return "<i>NA</i>";
                        }
                        color = "";
                        if (data["preferred"]) {
                            color = "w3-text-flat-peter-river";
                        }
                        if (data["canonical"]) {
                            response = '<i class="' + color + ' fas fa-star w3-tiny"></i> ';
                        } else {
                            response = '<i class="' + color + ' far fa-star w3-tiny"></i> ';
                        }
                        return response + data["HGVSc"];
                    },
                    sort: function ( data, type, row ) {
                        if (data["HGVSc"] == null) {
                            return -1;
                        }
                        return data["HGVSc"];
                    }
                }
            },
            {
                className: 'showTitle ',
                data: "annotations.HGVSp",
                mytitle: function ( data, type, row ) {
                    if (data == null) {
                        return "NA";
                    }
                    return data;
                },
                render: {
                    _: function ( data, type, row ) {
                        if (data == null) {
                            return "NA";
                        }
                        return data;
                    },
                    display: function ( data, type, row ) {
                        if (data == null) {
                            return "<i>NA</i>";
                        }
                        return data;
                    },
                    sort: function ( data, type, row ) {
                        if (data == null) {
                            return -1;
                        }
                        return data;
                    }
                }
            },
            {
                className: 'w3-border-right ',
                data: "annotations",
                mytitle: function ( data, type, row ) {
                    if (data["EXON"] == null) {
                        if(data["INTRON"] == null) {
                            return "NA";
                        }
                        return "Intron " + data["INTRON"];
                    }
                    return "Exon " + data["EXON"];
                },
                render: {
                    _: function ( data, type, row ) {
                        if (data["EXON"] == null) {
                            if(data["INTRON"] == null) {
                                return "NA";
                            }
                            return "Intron " + data["INTRON"];
                        }
                        return "Exon " + data["EXON"];
                    },
                    display: function ( data, type, row ) {
                        if (data["EXON"] == null) {
                            if(data["INTRON"] == null) {
                                return "<i>NA</i>";
                            }
                            return "<i>" + data["INTRON"] + "</i>";
                        }
                        return "<b>" + data["EXON"] + "</b>";
                    },
                    sort: function ( data, type, row ) {
                        prefix = data
                        if (data["EXON"] == null) {
                            if(data["INTRON"] == null) {
                                return "NA";
                            }
                            ei = data["INTRON"];
                        } else {
                            ei = data["EXON"];
                        }
                        pos_split = ei.split(/\//);
                        return pos_split[0];
                    },
                }
            },
            {% for c in sample.caller %}
            {
                className: 'w3-tiny showTitle w3-border-right',
                data: {},
                mytitle: function ( data, type, row ) {
                    final = ""
                    if( "{{ c }}" in data["caller"]) {
                        if (data["caller"]["{{ c }}"]["allelic_frequency"] >=0 && data["caller"]["{{ c }}"]["allelic_frequency"] < 0.25) {
                            final += "[MOS]\n";
                        } else if (data["caller"]["{{ c }}"]["allelic_frequency"] < 0.75) {
                            final += "[HTZ]\n";
                        } else if (data["caller"]["{{ c }}"]["allelic_frequency"] <= 1)  {
                            final += "[HOM]\n";
                        }

                        final += JSON.stringify(data["caller"]["{{ c }}"]["filter"]) + "\n";

                        if (data["caller"]["{{ c }}"]["allelic_frequency"]) {
                            final += "Allelic frequencie: " + ((data["caller"]["{{ c }}"]["allelic_frequency"]*100).toFixed(2)) + "% \n";
                        }
                        if (data["caller"]["{{ c }}"]["allelic_depth"] && data["caller"]["{{ c }}"]["depth"]) {
                            final += "Depth (var/total): " + data["caller"]["{{ c }}"]["allelic_depth"] + '/' + data["caller"]["{{ c }}"]["depth"] + "\n";
                        }
                    } else {
                        return "NA"
                    }

                    return final;
                },
                render: {
                    _: function ( data, type, row, meta ) {
                        if( "{{ c }}" in data["caller"]) {
                            return data["caller"]["{{ c }}"]["allelic_frequency"];
                        } else {
                            return "NA"
                        }
                    },
                    display: function ( data, type, row, meta ) {
                        if( "{{ c }}" in data["caller"]) {
                            filter = "";
                            if (JSON.stringify(data["caller"]["{{ c }}"]["filter"]) === JSON.stringify(["PASS"])) {
                                filter = '<i class="fas fa-flag w3-text-flat-green-sea"></i>';
                            } else {
                                filter = '<i class="fas fa-flag w3-text-flat-pomegranate"></i>';
                            }
                            if (data["caller"]["{{ c }}"]["allelic_frequency"] >=0 && data["caller"]["{{ c }}"]["allelic_frequency"] < 0.25) {
                                return '<i class="far fa-dot-circle w3-tiny"></i> ' + ((data["caller"]["{{ c }}"]["allelic_frequency"]*100).toFixed(2)) + "% <br />" +
                                '' + filter + ' ' + data["caller"]["{{ c }}"]["allelic_depth"] + '/' + data["caller"]["{{ c }}"]["depth"];
                            } else if (data["caller"]["{{ c }}"]["allelic_frequency"] < 0.75) {
                                return '<i class="fas fa-adjust w3-tiny"></i> ' + ((data["caller"]["{{ c }}"]["allelic_frequency"]*100).toFixed(2)) + "% <br />" +
                                '' + filter + ' '  + data["caller"]["{{ c }}"]["allelic_depth"] + '/' + data["caller"]["{{ c }}"]["depth"];
                            } else if (data["caller"]["{{ c }}"]["allelic_frequency"] <= 1)  {
                                return '<i class="fas fa-circle w3-tiny"></i> ' + ((data["caller"]["{{ c }}"]["allelic_frequency"]*100).toFixed(2)) + "% <br />" +
                                '' + filter + ' '  + data["caller"]["{{ c }}"]["allelic_depth"] + '/' + data["caller"]["{{ c }}"]["depth"];
                            }
                            return '<i>' + data["caller"]["{{ c }}"]["allelic_frequency"] + '</i>';
                        } else {
                            return "NA"
                        }
                    },
                    sort: function ( data, type, row, meta ) {
                        if( "{{ c }}" in data["caller"]) {
                            return data["caller"]["{{ c }}"]["allelic_frequency"];
                        } else {
                            return -1
                        }
                    },
                }
            },
            {% endfor %}
            {% for s in family_members %}
            {
                className: 'w3-tiny showTitle{% if loop.last  %} w3-border-right{% endif %}',
                data: "family.{{ s }}",
                render: {
                    _: function ( data, type, row, meta ) {
                        return data["allelic_frequency"];
                    },
                    display: function ( data, type, row, meta ) {
                        filter = "";
                        if (JSON.stringify(data["filter"]) === JSON.stringify(["PASS"])) {
                            filter = '<i class="fas fa-flag w3-text-flat-green-sea"></i>';
                        } else {
                            filter = '<i class="fas fa-flag w3-text-flat-pomegranate"></i>';
                        }
                        if (data["allelic_frequency"] >=0 && data["allelic_frequency"] < 0.25) {
                            return '<br /><i class="far fa-dot-circle w3-tiny"></i> ' + Math.round(data["allelic_frequency"]*100) + "% <br />" +
                            '' + filter + ' ' + data["allelic_depth"] + '/' + data["depth"];
                        } else if (data["allelic_frequency"] < 0.75) {
                            return '<br /><i class="fas fa-adjust w3-tiny"></i> ' + Math.round(data["allelic_frequency"]*100) + "% <br />" +
                            '' + filter + ' '  + data["allelic_depth"] + '/' + data["depth"];
                        } else if (data["allelic_frequency"] <= 1)  {
                            return '<br /><i class="fas fa-circle w3-tiny"></i> ' + Math.round(data["allelic_frequency"]*100) + "% <br />" +
                            '' + filter + ' '  + data["allelic_depth"] + '/' + data["depth"];
                        }
                        return '<i>' + data["allelic_frequency"] + '</i>';
                    },
                }
            },
            {% endfor %}
            {
                className: '',
                data: null,
                render : {
                    _: function ( data, type, row, meta ) {
                        if(data["annotations"]["gnomADg_AF"] != null) {
                            if (isNaN(parseFloat(data["annotations"]["gnomADg_AF"]).toFixed(6))) {
                                return null
                            }
                            return parseFloat(data["annotations"]["gnomADg_AF"]).toFixed(6);
                        } else {
                            return null;
                        }
                    },
                    display: function ( data, type, row, meta ) {
                        if(data["annotations"]["gnomADg_AF"] != null) {
                            if (isNaN(parseFloat(data["annotations"]["gnomADg_AF"]).toFixed(6))) {
                                return "<i>NA</i>"
                            }
                            gnomad = parseFloat(data["annotations"]["gnomADg_AF"]);
                            if (gnomad > 0.01) {
                                response = parseFloat(data["annotations"]["gnomADg_AF"]).toFixed(4)
                            } else {
                                response = parseFloat(data["annotations"]["gnomADg_AF"]).toExponential(2)
                            }
                            {% if genome_version == "grch37" %}
                                gnomad_version = "r2_1"
                                ext_exac = "?dataset=exac"
                                ext_r2_1 = "?dataset=gnomad_r2_1"
                                ext_r3 = "/gnomad_r2_1/gnomad_r3"
                                ext_r4 = "/gnomad_r2_1/gnomad_r4"
                                liftover_exac = ""
                                liftover_r2_1 = ""
                                liftover_r3 = "liftover/"
                                liftover_r4 = "liftover/"
                            {% else %}
                                gnomad_version = "r4"
                                ext_exac = "/gnomad_r4/exac"
                                ext_r2_1 = "/gnomad_r4/gnomad_r2_1"
                                ext_r3 = "?dataset=gnomad_r3"
                                ext_r4 = "?dataset=gnomad_r4"
                                liftover_exac = "liftover/"
                                liftover_r2_1 = "liftover/"
                                liftover_r3 = ""
                                liftover_r4 = ""
                            {% endif %}
                            gnomad_r = '<a target="_blank" href="https://gnomad.broadinstitute.org/variant/' + data["id"] + '?dataset=gnomad_' + gnomad_version + '" class="fa-fw w3-text-indigo w3-hover-text-black" style="cursor: pointer;"></span> '+ response +'</a> ';
                            gnomad1 = '<a title="ExAC" target="_blank" href="https://gnomad.broadinstitute.org/variant/' + liftover_exac + data["id"] + ext_exac + '" class="fa-fw w3-text-indigo w3-hover-text-black" style="cursor: pointer;"><span class="fa-layers"><i class="fas fa-bookmark"></i> <span class="fa-layers-text fa-inverse" data-fa-transform="shrink-10 up-2" style="font-weight:900">E</span></span></a> ';
                            gnomad2 = '<a title="GnomAD 2.1" target="_blank" href="https://gnomad.broadinstitute.org/variant/' + liftover_r2_1 + data["id"] + ext_r2_1 + '" class="fa-fw w3-text-indigo w3-hover-text-black" style="cursor: pointer;"><span class="fa-layers"><i class="fas fa-bookmark"></i> <span class="fa-layers-text fa-inverse" data-fa-transform="shrink-10 up-2" style="font-weight:900">2</span></span></a> ';
                            gnomad3 = '<a title="GnomAD 3" target="_blank" href="https://gnomad.broadinstitute.org/variant/' + liftover_r3 + data["id"] + ext_r3 + '" class="fa-fw w3-text-indigo w3-hover-text-black" style="cursor: pointer;"><span class="fa-layers"><i class="fas fa-bookmark"></i> <span class="fa-layers-text fa-inverse" data-fa-transform="shrink-10 up-2" style="font-weight:900">3</span></span></a> ';
                            gnomad4 = '<a title="GnomAD 4" target="_blank" href="https://gnomad.broadinstitute.org/variant/' + liftover_r4 + data["id"] + ext_r4 + '" class="fa-fw w3-text-indigo w3-hover-text-black" style="cursor: pointer;"><span class="fa-layers"><i class="fas fa-bookmark"></i> <span class="fa-layers-text fa-inverse" data-fa-transform="shrink-10 up-2" style="font-weight:900">4</span></span></a> ';
                            return '<i title="' + gnomad + '">' + gnomad_r + '</i> <small>(' + gnomad_version + ')</small><br />' + gnomad1 + gnomad2+ gnomad3+ gnomad4;
                        } else {
                            return "<i>NA</i>";
                        }
                    },
                    sort: function ( data, type, row, meta ) {
                        if(data["annotations"]["gnomADg_AF"] != null) {
                            if (isNaN(parseFloat(data["annotations"]["gnomADg_AF"]).toFixed(6))) {
                                return -0.5
                            }
                            return parseFloat(data["annotations"]["gnomADg_AF"]).toFixed(6);
                        } else {
                            return -1
                        }
                    }
                },
            },
            {
                className: 'w3-border-right showTitle ',
                data: "inseal",
                render : {
                    _: function ( data, type, row, meta ) {
                        return (data["occurrences"] > 0) ? data["occurrences"] : "NA";
                    },
                    sort: function ( data, type, row, meta ) {
                        return (data["occurrences"] > 0) ? data["occurrences"] : 0;
                    }
                },
            },
            {
                className: 'showTitle ',
                data: "clinvar",
                render: {
                    _: function ( data, type, row, meta ) {
                        stat = ''
                        if (data.CLNREVSTAT) {
                            stat = ' (' + clinvar_stars[data.CLNREVSTAT] + '/4)';
                        }
                        return data.CLNSIG + stat;
                    },
                    display: function ( data, type, row, meta ) {
                        color = 'silver';
                        colorHover = 'concrete';
                        if (data.CLNSIG) {
                            if (data.VARID) {
                                href='https://www.ncbi.nlm.nih.gov/clinvar/variation/' + data.VARID
                            }
                            pattern = /benign/i;
                            if (pattern.test(data.CLNSIG)) {
                                color = "turquoise";
                                colorHover = "green-sea";
                            }
                            pattern = /uncertain/i;
                            if (pattern.test(data.CLNSIG)) {
                                color = "sun-flower";
                                colorHover = "orange";
                            }
                            pattern = /pathogenic/i;
                            pattern2 = /establish/i;
                            if (pattern.test(data.CLNSIG) || pattern2.test(data.CLNSIG)) {
                                color = "alizarin";
                                colorHover = "pomegranate";
                            }
                            pattern = /conflicting/i;
                            if (pattern.test(data.CLNSIG)) {
                                color = "peter-river";
                                colorHover = "belize-hole";
                                pattern2 = /pathogenic/i;
                                pattern3 = /establish/i;
                                if (pattern2.test(data.CLNSIGCONF) || pattern3.test(data.CLNSIG)) {
                                    color = "carrot";
                                    colorHover = "pumpkin";
                                }
                            }
                            title = data.CLNSIG;
                            if (data.CLNSIGCONF) {
                                title = data.CLNSIGCONF;
                            }
                            n = 0
                            if (data.CLNREVSTAT) {
                                n  = clinvar_stars[data.CLNREVSTAT];
                                s = ""
                                for (const x of Array(4).keys()) {
                                    if (x<n) {
                                        s = s + '<i class="fa-solid fa-star fa-2xs"></i>';
                                    } else {
                                        s = s + '<i class="fa-regular fa-star fa-2xs"></i>';
                                    }
                                }
                            }
                            return "<a href='" + href + "' title='" + title + "' class='w3-tag w3-flat-" + color + " w3-hover-flat-" + colorHover + "' target='_blank' >" + s + " " +  data.CLNSIG + "</a>";
                        }
                        return data.CLNSIG;
                    },
                    sb: function ( data, type, row, meta ) {
                        value = "2 - NA";
                        if (data.CLNSIG) {
                            pattern = /benign/i;
                            if (pattern.test(data.CLNSIG)) {
                                value = "0 - Benign/Likely Benign"
                            }
                            pattern = /uncertain/i;
                            if (pattern.test(data.CLNSIG)) {
                                value = "3 - Uncertain significance"
                            }
                            pattern = /pathogenic/i;
                            pattern2 = /establish/i;
                            if (pattern.test(data.CLNSIG) || pattern2.test(data.CLNSIG)) {
                                value = "5 - Pathogenic/Likely Pathogenic"
                            }
                            pattern = /conflicting/i;
                            if (pattern.test(data.CLNSIG)) {
                                value = "1 - Conflicting (without Pathogenic)"
                                pattern2 = /pathogenic/i;
                                pattern3 = /establish/i;
                                if (pattern2.test(data.CLNSIGCONF) || pattern3.test(data.CLNSIG)) {
                                    value = "4 - Conflicting (with Pathogenic)"
                                }
                            }
                        }
                        return value;
                    },
                    sort: function ( data, type, row, meta ) {
                        value = 2;
                        if (data.CLNSIG) {
                            pattern = /benign/i;
                            if (pattern.test(data.CLNSIG)) {
                                value = 0;
                                pattern2 = /likely/i;
                                if (pattern2.test(data.CLNSIGCONF)) {
                                    value += 0.2;
                                }
                            }
                            pattern = /uncertain/i;
                            if (pattern.test(data.CLNSIG)) {
                                value = 3;
                            }
                            pattern = /pathogenic/i;
                            pattern2 = /establish/i;
                            if (pattern.test(data.CLNSIG) || pattern2.test(data.CLNSIG)) {
                                value = 5;
                                pattern3 = /likely/i;
                                if (pattern3.test(data.CLNSIGCONF)) {
                                    value -= 0.2;
                                }
                            }
                            pattern = /conflicting/i;
                            if (pattern.test(data.CLNSIG)) {
                                value = 1;
                                pattern2 = /pathogenic/i;
                                pattern3 = /establish/i;
                                if (pattern2.test(data.CLNSIGCONF) || pattern3.test(data.CLNSIG)) {
                                    value = 4;
                                }
                            }
                            return value;
                        }
                        return value;
                    },
                },
                searchBuilder: {
                    orthogonal:'sb'
                },
            },
            {
                className: ' w3-border-right ',
                data: "phenotypes",
                render: {
                    _: function ( data, type, row, meta ) {
                        inheritances = ""
                        for (d in data) {
                            title=data[d]["phenotype"];
                            inheritances = inheritances + data[d]["inheritances"] + ' (' + title + ') | ';
                        }
                        return inheritances.replace( /^\s*\|*|\s*\|*\s*$/g, '' );
                    },
                    display: function ( data, type, row, meta ) {
                        inheritances = ""
                        for (d in data) {
                            if (data[d]["inheritance"] != "[]") {
                                link = "https://www.omim.org/entry/" + data[d]["phenotypeMimNumber"];
                                title=data[d]["phenotype"];
                                inheritances = inheritances + '<a class="w3-text-flat-peter-river  w3-hover-flat-belize-hole" href="'+link+'" target="_blank" title="' + title + '">' + data[d]["inheritances"] + '</a> | ';
                            }
                        }
                        return inheritances.replace( /^\s*\|*|\s*\|*\s*$/g, '' );
                    }
                },
            },
            {
                className: 'showTitle ',
                data: "annotations.IMPACT",
                render: {
                    _: function ( data, type, row, meta ) {
                        return data;
                    },
                    display: function ( data, type, row, meta ) {
                        style = "style='display:inline-table;max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;'";
                        cell = "<span class='w3-tag w3-flat-" + impact_dict[data]["color"] + "' " + style + ">" + data + "</span>";
                        return cell;
                    },
                    filter: function ( data, type, row, meta ) {
                        return data.toString();
                    },
                    sort: function ( data, type, row, meta ) {
                        return impact_dict[data]["score"];
                    },
                },
                sType: "numeric"
            },
            {
                className: 'showTitle w3-border-right ',
                data: "annotations.Consequence",
                render: {
                    _: function ( data, type, row, meta ) {
                        cell = "";
                        for (idx in consequences_dict) {
                            if (data.includes(idx)){
                                cell += idx + " | "
                            }
                        }
                        return cell.replace( /^\s*\|*|\s*\|*\s*$/g, '' );
                    },
                    display: function ( data, type, row, meta ) {
                        cell = "";
                        for (idx in consequences_dict) {
                            if (data.includes(idx)){
                                color = idx in consequences_dict ? consequences_dict[idx]["color"] : "7f8c8d";
                                style = "style='display:inline-table;max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;background-color:#" + color + ";'";
                                cell += " <span class='w3-tag' " + style + ">" + idx + "</span>"
                            }
                        }
                        return cell;
                    },
                    filter: function ( data, type, row, meta ) {
                        return data.toString();
                    },
                    sort: function ( data, type, row, meta ) {
                        var sort = 0;
                        for (idx in data) {
                            sort += consequences_dict[data[idx]]["score"];
                        }
                        return Math.log10(sort);
                    }
                },
                sType: "numeric"
            },
            {
                className: 'showTitle ',
                data: "annotations.MES_var",
                render: {
                    _: function ( data, type, row, meta ) {
                        if (data == null){
                            return null;
                        }
                        return Math.abs(parseFloat(data).toFixed(3));
                    },
                    display: function ( data, type, row, meta ) {
                        if (data == null){
                            return "<i>NA</i>";
                        }
                        value = parseFloat(data).toFixed(2)
                        classw3css = "";
                        if (Math.abs(value) >= 15) {
                            classw3css = "w3-text-flat-pomegranate";
                        }
                        return "<span class='" + classw3css + "'>" + value + "</span>";
                    },
                },
            },
            {
                className: 'showTitle ',
                data: "annotations.spliceAI",
                render: {
                    _: function ( data, type, row, meta ) {
                        if (data == null){
                            return null;
                        }
                        return parseFloat(data).toFixed(3);
                    },
                    display: function ( data, type, row, meta ) {
                        if (data == null){
                            return "<i>NA</i>";
                        }
                        value = parseFloat(data).toFixed(2)
                        classw3css = "";
                        if (value >= 0.8) {
                            classw3css = "w3-text-flat-pomegranate";
                        } else if (value >= 0.5) {
                            classw3css = "w3-text-flat-orange";
                        } else if (value >= 0.2) {
                            classw3css = "w3-text-flat-sun-flower";
                        }
                        return "<span class='" + classw3css + "'>" + value + "</span>";
                    },
                },
            },
            {
                className: 'showTitle w3-border-right ',
                data: "annotations.missensesMean",
                render: {
                    _: function ( data, type, row, meta ) {
                        if(data != null) {
                            return data.toFixed(4);
                        } else {
                            return null;
                        }
                    },
                    display: function ( data, type, row, meta ) {
                        if (data == null){
                            return "<i>NA</i>";
                        }
                        value = parseFloat(data).toFixed(3)
                        classw3css = "";
                        if (value >= 0.95) {
                            classw3css = "w3-tag w3-flat-pomegranate";
                        } else if (value >= 0.9) {
                            classw3css = "w3-text-flat-pomegranate";
                        } else if (value >= 0.75) {
                            classw3css = "w3-text-flat-orange";
                        } else if (value >= 0.5) {
                            classw3css = "w3-text-flat-sun-flower";
                        }
                        return "<span style='display:inline-table;' class='" + classw3css + "'>" + value + "</span>";
                    },
                    sort: function ( data, type, row, meta ) {
                        if(data != null) {
                            return data.toFixed(4);
                        } else {
                            num = -1
                            return num.toFixed(4);
                        }
                    }
                },
            },
            {
                className: disabled_class + "seal-form-report showTitle  w3-center w3-border-right ",
                data: {
                    "data": "reported",
                },
                render: function ( data, type, row, meta ) {
                    if(type === 'display') {
                        const id_var=data["id"];
                        const id=data["id"] + "reported";
                        var check="";
                        if (data["reported"]) {
                            check='checked="checked"';
                        }
                        return '<input id="'+ id +'" type="checkbox" ' + check + ' onclick="toggle_var2sample_status(\''+ id +'\', \'' + id_var + '\',' + sample_id + ', \'reported\', this);">';
                    }
                    return data["reported"] ? "Reported" : "Not Reported";
                },
                searchBuilder: {
                    orthogonal: {
                        display: 'filter'
                    }
                }
            },
            {
                className: disabled_class + "no-padding seal-form-report showTitle  w3-center w3-border-right ",
                data: {
                    "data": "class_variant"
                },
                render:
                    function ( data, type, row ) {
                        if(type === 'display') {
                            id_var = data.id
                            class_variant = data.class_variant ? data.class_variant : 0;
                            dropdown = ""
                            for (c in class_variant_html) {
                                dropdown += '<a onclick="toggle_class(\'' + id_var + '\', ' + sample_id + ', ' + c +', this)" class="w3-bar-item w3-button" style="width:inherit">'+
                                        class_variant_html[c]+
                                    '</a>'
                            }
                            response = `<div class="w3-tiny w3-dropdown-click w3-right" style="background-color:transparent">
                                <button class="w3-button button-class w3-left-align" onclick="toggle_dd_class('button-class-` + id_var + `')" style="min-width:168px;" id="button-class-` + id_var + `">
                                    ` + class_variant_html[class_variant] + `
                                </button>
                                <div class="w3-dropdown-content w3-bar-block w3-border" style="min-width:200px" data-container="tbody" id="button-class-` + id_var + `-content">
                                    `+ dropdown +`
                                </div>
                            </div>`
                            return response;
                        }
                        if(type === 'export') {
                            return class_variant_export[data.class_variant ? data.class_variant : 0];
                        }
                        return class_variant_html[data.class_variant ? data.class_variant : 0];
                    },
                searchBuilder: {
                    orthogonal: {
                        display: 'filter'
                    }
                }
            },
            {
                className: 'w3-border-left details-control w3-center',
                orderable: false,
                data: "id",
                render: {
                    _: function ( data, type, row ) {
                        return data;
                    },
                    display: function ( data, type, row ) {
                        details = '<i onclick="openDetailsVariantModal(\'' + data + '\', ' + sample_id + ')" class="w3-text-flat-turquoise w3-hover-text-flat-green-sea fas fa-plus-circle" style="cursor: pointer;" title="See details"></i>';
                        hide = '<i onclick="hideRow(\'' + data + '\', ' + sample_id + ', this)" class="w3-text-flat-pumpkin w3-hover-text-flat-carrot fas fa-eye-slash remove" style="cursor: pointer;" title="Hide row"></i> ';
                        return details + " " + hide;
                    },
                },
            },
            // Hiden column for DEFGEN file generation
            {
                data: "annotations.HGVSp",
                render: {
                    _:function ( data, type, row ) {
                        psplit = String(data).split(":");
                        if (psplit.length > 1) {
                            return psplit[1].replace("p.", "p.(") + ")";
                        }
                        return ""
                    },
                },
                searchable: false , visible: false
            },
            {
                data: "annotations.HGVSc",
                render: {
                    _:function ( data, type, row ) {
                        psplit = String(data).split(":");
                        if (psplit.length > 1) {
                            return psplit[1];
                        }
                        return ""
                    },
                },
                searchable: false , visible: false
            },
            {
                data: "annotations.NEAREST",
                searchable: false , visible: false
            },
            {
                data: "annotations.Feature",
                searchable: false , visible: false
            },
            {
                data: "annotations.Existing_variation",
                render: {
                    _:function ( data, type, row ) {
                        if (data.length > 0) {
                            for (idx_var in data) {
                                id_var = data[idx_var]
                                if (RegExp("^COS[MV][0-9]+").test(id_var)) {
                                    return id_var;
                                }
                            }
                        }
                        return "";
                    },
                },
                searchable: false , visible: false
            },
            {
                data: "annotations.Existing_variation",
                render: {
                    _:function ( data, type, row ) {
                        if (data.length > 0) {
                            for (idx_var in data) {
                                id_var = data[idx_var]
                                if (RegExp("^rs[0-9]+").test(id_var)) {
                                    return id_var;
                                }
                            }
                        }
                        return "";
                    },
                },
                searchable: false , visible: false
            },
            {
                data: "pos",
                searchable: false , visible: false
            },
            {
                data: "chr",
                searchable: false , visible: false
            },
            {
                data: null, "defaultContent": "hg38",
                searchable: false , visible: false
            },
            {
                data: "annotations",
                render: {
                    _: function ( data, type, row ) {
                        if (data["EXON"] == null) {
                            if(data["INTRON"] == null) {
                                return "NA";
                            }
                            return "Intron " + data["INTRON"].split("/")[0];
                        }
                        return "Exon " + data["EXON"].split("/")[0];
                    },
                },
                searchable: false , visible: false
            },
            {
                data: "allelic_frequency",
                searchable: true , visible: false
            },
            { data: "depth", searchable: true , visible: false},
            { data: "allelic_depth",searchable: true , visible: false},
        ];
        var number_family = {{ family_members|length }};
        var number_caller = {{ sample.caller|length }};
    </script>

    <script type="text/javascript" src="{{ url_for('static', filename='seal/analysis/sample.js') }}"></script>
{% endblock %}
